#include "Pokitto.h"
#include "Tilemap.hpp"

Pokitto::Core game;
Pokitto::Buttons btn;

// ------------ palette -----------------
const unsigned short palette[] = {
    0x79a7,0x821,0x2908,0x3bf3,
    0x328b,0x7556,0x7569,0xffbb,
    0xbdd5,0xf6f2,0xedce,0xbc6a,
    0x7ac5,0xe4ad,0xbb4b,0x4944
};


// ------------ tiles1 -----------------
/*
-----  -   - -
----
--
-             ##
        ## #####
       #########
      ##########
     ###########
     ###########
    ############
    ############
     ###########
     ###########
     ###########
      ##########
      ##########
*/

const unsigned char tiles1_tile8[] = {
0x00,0x00,0x33,0x33,0x33,0x33,0x33,0x33,
0x00,0x03,0x36,0x63,0x66,0x36,0x33,0x66,
0x00,0x36,0x63,0x66,0x66,0x66,0x63,0x66,
0x00,0x36,0x66,0x66,0x66,0x66,0x66,0x66,
0x03,0x33,0x66,0x66,0x68,0x86,0x66,0x66,
0x36,0x66,0x66,0x68,0x88,0x88,0x88,0x66,
0x36,0x66,0x66,0x88,0x88,0x88,0x88,0x88,
0x03,0x33,0x68,0x88,0x88,0x88,0x88,0x88,
0x36,0x66,0x88,0x88,0x88,0x88,0x88,0x88,
0x36,0x66,0x88,0x88,0x88,0x88,0x88,0x88,
0x36,0x66,0x68,0x88,0x88,0x88,0x88,0x88,
0x03,0x66,0x88,0x88,0x88,0x88,0x88,0x88,
0x36,0x66,0x88,0x88,0x88,0x88,0x88,0x88,
0x03,0x36,0x88,0x88,0x88,0x88,0x88,0x88,
0x33,0x68,0x88,0x88,0x88,0x88,0x88,0x88,
0x36,0x68,0x88,0x88,0x88,0x88,0x88,0x88
};

// ------------ tiles2 -----------------
/*
 -     -  -   -

   # #     #
     #  ## ## ##
# # ## #########
# ##############
################
################
################
################
################
################
################
################
################
################
*/


const unsigned char tiles2_tile8[] = {
0x33,0x66,0x88,0x88,0x88,0x88,0x88,0x88,
0x03,0x36,0x66,0x88,0x88,0x88,0x88,0x88,
0x33,0x66,0x88,0x88,0x88,0x88,0x88,0x88,
0x36,0x86,0x68,0x88,0x88,0x88,0x88,0x88,
0x36,0x66,0x88,0x88,0x88,0x88,0x88,0x88,
0x36,0x88,0x88,0x88,0x88,0x88,0x88,0x88,
0x33,0x36,0x68,0x88,0x88,0x88,0x88,0x88,
0x03,0x66,0x88,0x88,0x88,0x88,0x88,0x88,
0x33,0x38,0x88,0x88,0x88,0x88,0x88,0x88,
0x36,0x68,0x88,0x88,0x88,0x88,0x88,0x88,
0x03,0x66,0x88,0x88,0x88,0x88,0x88,0x88,
0x36,0x88,0x88,0x88,0x88,0x88,0x88,0x88,
0x33,0x38,0x88,0x88,0x88,0x88,0x88,0x88,
0x36,0x66,0x88,0x88,0x88,0x88,0x88,0x88,
0x06,0x68,0x88,0x88,0x88,0x88,0x88,0x88,
0x36,0x68,0x88,0x88,0x88,0x88,0x88,0x88
};

// Note: Each 8-bit map item contains 2 tiles so it takes less memory.
const uint8_t m[] = {
    1,0,0,0,
    1,0,0,0,
    1,0,0,0x11,
    0,1,1,0,
    0,1,1,0
};

int main(){
    game.begin();
    game.display.persistence=1;
    game.setFrameRate(200);

    Pokitto::Display::load565Palette( palette );

    Tilemap map;
    map.tiles[0].set( 16, 16, tiles1_tile8 );
    map.tiles[1].set( 16, 16, tiles2_tile8 );
    map.set( 8, 5, m );

    int32_t x = -20;
    int32_t y = 10;
    while (game.isRunning()) {

        if( !game.update() )
            continue;

        if(btn.leftBtn()) x--;
        else if(btn.rightBtn()) x++;
        if(btn.upBtn()) y--;
        else if(btn.downBtn()) y++;

        map.draw(x, y);

    }

    return 1;
}
